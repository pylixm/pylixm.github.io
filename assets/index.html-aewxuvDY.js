import{_ as i,c as a,a as n,o as e}from"./app-DdES4ywf.js";const l={};function t(p,s){return e(),a("div",null,[...s[0]||(s[0]=[n(`<h2 id="环境" tabindex="-1"><a class="header-anchor" href="#环境"><span>环境</span></a></h2><p>web框架：tornado 4.4.2 ORM： SQLAlchemy 1.2.0b1 DB: MySQL 5.7</p><h2 id="问题描述" tabindex="-1"><a class="header-anchor" href="#问题描述"><span>问题描述</span></a></h2><p>我们的项目为tornado 开发的API服务，使用SQLALchemy 作为ORM与数据库做交互，SQLAlchemy我们使用了链接池的方式。代码如下：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">connect_str </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysql+pymysql://</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">%s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">%s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">@</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">%s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">%s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">%s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">?charset=utf8</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> %</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">settings</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">get</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">user</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">),</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> settings</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">get</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">password</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">),</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                                                    settings</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">get</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">host</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">),</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> settings</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">get</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">port</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">),</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> settings</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">get</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">name</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">))</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">engine </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> create_engine</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">connect_str</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> pool_size</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">10</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> pool_recycle</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">300</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> echo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">False</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> max_overflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在线上运行中，我们发现每隔一段时间会报数据库链接的错误，错误日志如下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>    Traceback (most recent call last):</span></span>
<span class="line"><span>      File &quot;/usr/local/myapi/env/lib/python3.6/site-packages/sqlalchemy/pool.py&quot;, line 687, in _finalize_fairy</span></span>
<span class="line"><span>        fairy._reset(pool)</span></span>
<span class="line"><span>      File &quot;/usr/local/myapi/env/lib/python3.6/site-packages/sqlalchemy/pool.py&quot;, line 827, in _reset</span></span>
<span class="line"><span>        self._reset_agent.rollback()</span></span>
<span class="line"><span>      File &quot;/usr/local/myapi/env/lib/python3.6/site-packages/sqlalchemy/engine/base.py&quot;, line 1612, in rollback</span></span>
<span class="line"><span>        self._do_rollback()</span></span>
<span class="line"><span>      File &quot;/usr/local/myapi/env/lib/python3.6/site-packages/sqlalchemy/engine/base.py&quot;, line 1650, in _do_rollback</span></span>
<span class="line"><span>        self.connection._rollback_impl()</span></span>
<span class="line"><span>      File &quot;/usr/local/myapi/env/lib/python3.6/site-packages/sqlalchemy/engine/base.py&quot;, line 703, in _rollback_impl</span></span>
<span class="line"><span>        self._handle_dbapi_exception(e, None, None, None, None)</span></span>
<span class="line"><span>      File &quot;/usr/local/myapi/env/lib/python3.6/site-packages/sqlalchemy/engine/base.py&quot;, line 1393, in _handle_dbapi_exception</span></span>
<span class="line"><span>        exc_info</span></span>
<span class="line"><span>      File &quot;/usr/local/myapi/env/lib/python3.6/site-packages/sqlalchemy/util/compat.py&quot;, line 203, in raise_from_cause</span></span>
<span class="line"><span>        reraise(type(exception), exception, tb=exc_tb, cause=cause)</span></span>
<span class="line"><span>      File &quot;/usr/local/myapi/env/lib/python3.6/site-packages/sqlalchemy/util/compat.py&quot;, line 186, in reraise</span></span>
<span class="line"><span>        raise value.with_traceback(tb)</span></span>
<span class="line"><span>      File &quot;/usr/local/myapi/env/lib/python3.6/site-packages/sqlalchemy/engine/base.py&quot;, line 701, in _rollback_impl</span></span>
<span class="line"><span>        self.engine.dialect.do_rollback(self.connection)</span></span>
<span class="line"><span>      File &quot;/usr/local/myapi/env/lib/python3.6/site-packages/sqlalchemy/dialects/mysql/base.py&quot;, line 1572, in do_rollback</span></span>
<span class="line"><span>        dbapi_connection.rollback()</span></span>
<span class="line"><span>      File &quot;/usr/local/myapi/env/lib/python3.6/site-packages/pymysql/connections.py&quot;, line 788, in rollback</span></span>
<span class="line"><span>        self._execute_command(COMMAND.COM_QUERY, &quot;ROLLBACK&quot;)</span></span>
<span class="line"><span>      File &quot;/usr/local/myapi/env/lib/python3.6/site-packages/pymysql/connections.py&quot;, line 1088, in _execute_command</span></span>
<span class="line"><span>        self._write_bytes(packet)</span></span>
<span class="line"><span>      File &quot;/usr/local/myapi/env/lib/python3.6/site-packages/pymysql/connections.py&quot;, line 1040, in _write_bytes</span></span>
<span class="line"><span>        &quot;MySQL server has gone away (%r)&quot; % (e,))</span></span>
<span class="line"><span>    sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, &quot;MySQL server has gone away (BrokenPipeError(32, &#39;Broken pipe&#39;))&quot;)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或如下错误：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>(pymysql.err.OperationalError) (2014, &#39;Command Out of Sync&#39;)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="分析过程" tabindex="-1"><a class="header-anchor" href="#分析过程"><span>分析过程</span></a></h2><p>1、根据错误，怀疑是SQLAlchemy 链接池回收的问题。通过阅读链接池的官方文档, 看到如下描述：</p><blockquote><p>Above, any DBAPI connection that has been open for more than one hour will be invalidated and replaced, upon next checkout. Note that the invalidation only occurs during checkout - not on any connections that are held in a checked out state. pool_recycle is a function of the Pool itself, independent of whether or not an Engine is in use.</p></blockquote><p><a href="http://docs.sqlalchemy.org/en/latest/core/pooling.html?highlight=pool_recycle#setting-pool-recycle" target="_blank" rel="noopener noreferrer">这里</a></p><p>可知，链接的回收并不会导致正在被使用的链接的异常。</p><p>将回收时间调小测试，确实并没有引起以上的报错。</p><p>2、根据错误信息查询，发现github社区有人遇到同样的报错，是因为mysql数据库的数据包太大导致，见<a href="https://github.com/PyMySQL/PyMySQL/issues/426" target="_blank" rel="noopener noreferrer">这里</a>。后来<code>pymysql</code>的维护者，针对此问题做了修正。查看我们数据的参数 <code>max_allowed_packet</code>足够大，所以也不回一切上边的报错。pymysql 默认这个值为 16M(<a href="http://pymysql.readthedocs.io/en/latest/modules/connections.html?highlight=max_allowed_packet" target="_blank" rel="noopener noreferrer">这里</a>),也足够大。</p><p>3、查询stackoverflow, 发下如下问题：<a href="https://stackoverflow.com/questions/18054224/python-sqlalchemy-mysql-server-has-gone-away" target="_blank" rel="noopener noreferrer">Python SQLAlchemy - “MySQL server has gone away”</a>。按照此解决方法，增加链接池的监听函数，代码如下：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> checkout_listener</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">dbapi_con</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> con_record</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> con_proxy</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">):</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    try</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        try</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            dbapi_con</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ping</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">False</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        except</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> TypeError</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            dbapi_con</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ping</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    except</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dbapi_con</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OperationalError </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">as</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> exc</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        if</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> exc</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">args</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> in</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2006</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2013</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2014</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2045</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2055</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">):</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            raise</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DisconnectionError</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        else</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            raise</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">event</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">listen</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">engine</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">checkout</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> checkout_listener</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码解读： 1、使用SQLAlchemy 的<code>PoolListener</code>监听链接池的可用性， 2、在链接被<code>checkout</code>使用时，先验证链接的有效性，若无效则抛出<code>DisconnectionError</code>错误，让链接池回收，重新创建个新的链接。</p><p>更多SQLAlchemy无效链接的描述，见<a href="http://docs.sqlalchemy.org/en/latest/core/pooling.html#dealing-with-disconnects" target="_blank" rel="noopener noreferrer">官方文档</a></p><p>4、增加链接池监听函数后也是不见好转。便通过日志打印，跟踪了session 的分配和回收过程，<code>发现在tornado 的多进程异步模式下，多进程获取的session 并不是主进程的session,而是从连接池中获取的新的session，而这个session,并没有关闭操作，主进程中 </code>on_finish<code> 函数中的</code>remove<code>只能交还主进程中的session</code>。看到这里，恍然大悟，非阻塞进程获取的新的session,长期没有交还连接池，导致session超时，mysql 自动断开连接。在非阻塞进程中，增加交还session的代码后解决问题。</p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2><ul><li><a href="https://discorporate.us/jek/talks/SQLAlchemy-EuroPython2010.pdf" target="_blank" rel="noopener noreferrer">https://discorporate.us/jek/talks/SQLAlchemy-EuroPython2010.pdf</a></li><li><a href="http://docs.sqlalchemy.org/en/latest/core/pooling.html#dealing-with-disconnects" target="_blank" rel="noopener noreferrer">SQLAlchemy无效链接描述</a></li><li><a href="http://docs.sqlalchemy.org/en/latest/core/pooling.html#pool-events" target="_blank" rel="noopener noreferrer">SQLALchemy事件描述</a></li></ul>`,23)])])}const k=i(l,[["render",t]]),r=JSON.parse('{"path":"/pages/70b9d8/","title":"SQLAlchemy 数据库链接池问题排查记录","lang":"zh-CN","frontmatter":{"title":"SQLAlchemy 数据库链接池问题排查记录","tags":["Tornado","sqlalchemy"],"permalink":"/pages/70b9d8/","createTime":"2023/09/08 17:36:02","description":"环境 web框架：tornado 4.4.2 ORM： SQLAlchemy 1.2.0b1 DB: MySQL 5.7 问题描述 我们的项目为tornado 开发的API服务，使用SQLALchemy 作为ORM与数据库做交互，SQLAlchemy我们使用了链接池的方式。代码如下： 在线上运行中，我们发现每隔一段时间会报数据库链接的错误，错误日志如下...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"SQLAlchemy 数据库链接池问题排查记录\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-09-30T08:57:49.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://pylixm.top/pages/70b9d8/"}],["meta",{"property":"og:site_name","content":"底层逻辑"}],["meta",{"property":"og:title","content":"SQLAlchemy 数据库链接池问题排查记录"}],["meta",{"property":"og:description","content":"环境 web框架：tornado 4.4.2 ORM： SQLAlchemy 1.2.0b1 DB: MySQL 5.7 问题描述 我们的项目为tornado 开发的API服务，使用SQLALchemy 作为ORM与数据库做交互，SQLAlchemy我们使用了链接池的方式。代码如下： 在线上运行中，我们发现每隔一段时间会报数据库链接的错误，错误日志如下..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-09-30T08:57:49.000Z"}],["meta",{"property":"article:tag","content":"sqlalchemy"}],["meta",{"property":"article:tag","content":"Tornado"}],["meta",{"property":"article:modified_time","content":"2025-09-30T08:57:49.000Z"}]]},"readingTime":{"minutes":3.05,"words":916},"git":{"createdTime":1759222669000,"updatedTime":1759222669000,"contributors":[{"name":"pylixm","username":"pylixm","email":"pyli.xm@gmail.com","commits":1,"avatar":"https://avatars.githubusercontent.com/pylixm?v=4","url":"https://github.com/pylixm"}]},"autoDesc":true,"filePathRelative":"01.开发语言/01.Python/10.Tornado/03.tornado-sqlalchemy.md","headers":[],"categoryList":[{"id":"59843f","sort":1,"name":"开发语言"},{"id":"9d2a49","sort":1,"name":"Python"},{"id":"9e4689","sort":10,"name":"Tornado"}]}');export{k as comp,r as data};
