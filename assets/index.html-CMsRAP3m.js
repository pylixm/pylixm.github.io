import{_ as i,c as a,a as n,o as l}from"./app-DdES4ywf.js";const h={};function k(p,s){return l(),a("div",null,[...s[0]||(s[0]=[n(`<blockquote><p>今天在 FastAPI 的一个交流群中回答了个网友的问题，发现自己对 Python 作用域已忘记大半，特意查了些资料，记录备查，希望对朋友们理解有帮助。</p></blockquote><p>阅读本文，你可以了解如下内容： <img src="https://gitee.com/pylixm/picture/raw/master/2022-3-14/1647258735636-white-list-template.xlsx.png" alt="white-list-template.xlsx"></p><p>Python 中常用的变量作用域有这么几种：局部变量、非局部变量、全局变量，下面我们来举例说明。</p><h3 id="局部变量" tabindex="-1"><a class="header-anchor" href="#局部变量"><span>局部变量</span></a></h3><p>在函数体或局部范围内声明的变量称为局部变量。参考如下实例：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> foo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">():</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    y </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">local</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">y</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">y </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">global</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">foo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">y</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># local</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># global</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>局部变量尽在局部作用域内有效，可以看到上边代码块有两个同名的变量 <code>y</code>，函数内的局部变量 <code>y</code> 并不会影响全局变量 <code>y</code>。</p><h3 id="非局部变量" tabindex="-1"><a class="header-anchor" href="#非局部变量"><span>非局部变量</span></a></h3><p>Python 3 中增加了关键字 <code>nonlocal</code> 用来创建非局部变量，主要用在未定义局部变量的嵌套函数内。参考如下实例：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> outer</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">():</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    x </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">local</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> inner</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">():</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">        nonlocal</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">inner:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        x </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">nonlocal</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    inner</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">outer:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">x </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">global</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">outer</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">glabal:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># inner: local</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># outer: nonlocal</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># glabal: global</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>nolocal</code> 关键字会向上一个作用域查找，取最近的一个变量定义</strong>。如上代码块中，x 向上最近的定义是 <code>x=&quot;local&quot;</code>，并没有取局部变量 x (严格来说 inner 函数中的 x 已不是局部变量，而是修改赋值的 outer 函数中的变量 x)和全局的变量 x。</p><h3 id="全局变量" tabindex="-1"><a class="header-anchor" href="#全局变量"><span>全局变量</span></a></h3><p>在 Python 中，在函数之外或在全局范围内声明的变量称为全局变量。全局变量允许在函数内部和外部访问，但是不允许在函数内部修改。参考如下实例：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">x </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">global</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> foo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">():</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">x inside:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">foo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">x outside:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># (&#39;x inside:&#39;, &#39;global&#39;)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># (&#39;x outside:&#39;, &#39;global&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> foo2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">():</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    x </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">foo2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># UnboundLocalError: local variable &#39;x&#39; referenced before assignment</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>全局变量不允许在函数内部做修改，如需要，则要用到关键字 <code>global</code> 。</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">x </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">global</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> foo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">():</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    global</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    x </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">x inside:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">foo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">x outside:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># x inside: globalglobal</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># x outside: globalglobal</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>global</code> 关键字和 <code>nonlocal</code> 类似也是从其他作用域搜索变量定义，但它<strong>仅仅</strong>是搜索全局作用域内的变量定义。参考如下实例：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> outer</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">():</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    x </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">local</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> inner</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">():</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">        global</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">inner:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        x </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">nonlocal</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    inner</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">outer:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">x </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">global</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">outer</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">glabal:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># inner: global</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># outer: local</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># glabal: nonlocal</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> foo2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">():</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    global</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    x </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">x inside:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>inner 函数中 global 定义的变量 x，取的是全局变量中的变量 x。</p><h3 id="工具模块-dis" tabindex="-1"><a class="header-anchor" href="#工具模块-dis"><span>工具模块 dis</span></a></h3><p>官方提供了一个工具模块 dis，可以查看函数在 Python 解释器执行的字节码。我们可以通过它来看具体的作用域调用过程，如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> python3</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Python</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 3.8.10</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (default, </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">May</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">  4</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 2021,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 03:05:50</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Clang </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">12.0.0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">clang</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1200</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">32</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">29</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> on darwin</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Type</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">help</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">copyright</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">credits</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> or</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">license</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> for</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> more</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> information.</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">x</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">global</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">def</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> foo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">     print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&quot;x inside:&quot;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">def</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> foo1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">     global</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> x</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">     print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&quot;x inside:&quot;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">def</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> foo2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">     global</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> x</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">     x</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> x</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> *</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">     print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&quot;x inside:&quot;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">def</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> foo3</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">     x</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> x</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> *</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">     print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">&quot;x inside:&quot;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> x</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">from</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dis</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> import</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dis</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dis(foo</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  2</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">           0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_GLOBAL</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">              0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (print)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              2</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_CONST</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">               1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">x inside:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              4</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_GLOBAL</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">              1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (x)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              6</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> CALL_FUNCTION</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">            2</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              8</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> POP_TOP</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             10</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_CONST</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">               0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (None)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             12</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> RETURN_VALUE</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dis(foo1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  3</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">           0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_GLOBAL</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">              0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (print)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              2</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_CONST</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">               1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">x inside:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              4</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_GLOBAL</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">              1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (x)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              6</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> CALL_FUNCTION</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">            2</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              8</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> POP_TOP</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             10</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_CONST</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">               0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (None)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             12</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> RETURN_VALUE</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dis(foo2</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  3</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">           0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_GLOBAL</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">              0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (x)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              2</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_CONST</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">               1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (2)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              4</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> BINARY_MULTIPLY</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              6</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> STORE_GLOBAL</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">             0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (x)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  4</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">           8</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_GLOBAL</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">              1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (print)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             10</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_CONST</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">               2</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">x inside:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             12</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_GLOBAL</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">              0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (x)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             14</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> CALL_FUNCTION</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">            2</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             16</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> POP_TOP</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             18</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_CONST</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">               0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (None)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             20</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> RETURN_VALUE</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dis(foo3</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  2</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">           0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_FAST</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">                0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (x)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              2</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_CONST</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">               1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (2)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              4</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> BINARY_MULTIPLY</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">              6</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> STORE_FAST</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">               0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (x)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  3</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">           8</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_GLOBAL</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">              0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (print)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             10</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_CONST</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">               2</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">x inside:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             12</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_FAST</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">                0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (x)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             14</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> CALL_FUNCTION</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">            2</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             16</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> POP_TOP</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             18</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LOAD_CONST</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">               0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (None)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">             20</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> RETURN_VALUE</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到在函数读取全局变量时，字节码是完全一致的，所以他们的行为也是一致的。当函数在修改全局变量时，字节码明显不一样，使用 <code>global</code>定义的会先<code>LOAD_GLOBAL</code>，dis 模块的更多用法可参考 <a href="https://docs.python.org/zh-cn/3/library/dis.html" title="Python官方文档" target="_blank" rel="noopener noreferrer">Python 官方文档</a>。</p><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><p>至此，Python 常用的变量作用域我们便说完了。总结下，局部变量只能在定义的代码块作用域中访问修改。非局部变量向上查找最近的变量定义，可访问可修改。全局变量可以在全局代码块访问和修改，只能在函数内访问不能修改。</p><p>除了上边我们说的，Python 还有<strong>内部作用域</strong>和<strong>内置作用域</strong>。顾名思义，内部就是多层函数嵌套时，作用域的查找是由内而外的，中间层的作用域就是内部作用域。内置作用域则是 Python 自己内置的一些变量关键字的作用域，由 Python 解释器内部使用。</p><p>我是DeanWu，一个努力成为真正SRE的人。</p><blockquote><p>关注公众号「码农吴先生」, 可第一时间获取最新文章。回复关键字「go」「python」获取我收集的学习资料，也可回复关键字「小二」，加我wx拉你进技术交流群，聊技术聊人生~</p></blockquote><p><img src="https://gitee.com/pylixm/picture/raw/master/2020-12-14/deanwu_wechat.png" alt=""></p><h3 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料"><span>参考资料</span></a></h3><ul><li>https://www.programiz.com/python-programming/global-keyword</li><li>https://docs.python.org/3/library/dis.html https://docs.python.org/3/faq/programming.html#what-are-the-rules-for-local-and-global-variables-in-python</li><li>https://docs.python.org/3/faq/programming.html#how-do-i-share-global-variables-across-modules</li></ul>`,31)])])}const e=i(h,[["render",k]]),d=JSON.parse('{"path":"/pages/61d743/","title":"「Python Tips」 - Python 变量作用域详解","lang":"zh-CN","frontmatter":{"title":"「Python Tips」 - Python 变量作用域详解","tags":["Python"],"permalink":"/pages/61d743/","createTime":"2023/09/08 17:36:02","description":"今天在 FastAPI 的一个交流群中回答了个网友的问题，发现自己对 Python 作用域已忘记大半，特意查了些资料，记录备查，希望对朋友们理解有帮助。 阅读本文，你可以了解如下内容： white-list-template.xlsx Python 中常用的变量作用域有这么几种：局部变量、非局部变量、全局变量，下面我们来举例说明。 局部变量 在函数体或...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"「Python Tips」 - Python 变量作用域详解\\",\\"image\\":[\\"https://gitee.com/pylixm/picture/raw/master/2022-3-14/1647258735636-white-list-template.xlsx.png\\",\\"https://gitee.com/pylixm/picture/raw/master/2020-12-14/deanwu_wechat.png\\"],\\"dateModified\\":\\"2025-09-30T08:57:49.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://pylixm.top/pages/61d743/"}],["meta",{"property":"og:site_name","content":"底层逻辑"}],["meta",{"property":"og:title","content":"「Python Tips」 - Python 变量作用域详解"}],["meta",{"property":"og:description","content":"今天在 FastAPI 的一个交流群中回答了个网友的问题，发现自己对 Python 作用域已忘记大半，特意查了些资料，记录备查，希望对朋友们理解有帮助。 阅读本文，你可以了解如下内容： white-list-template.xlsx Python 中常用的变量作用域有这么几种：局部变量、非局部变量、全局变量，下面我们来举例说明。 局部变量 在函数体或..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://gitee.com/pylixm/picture/raw/master/2022-3-14/1647258735636-white-list-template.xlsx.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-09-30T08:57:49.000Z"}],["meta",{"property":"article:tag","content":"Python"}],["meta",{"property":"article:modified_time","content":"2025-09-30T08:57:49.000Z"}]]},"readingTime":{"minutes":4.4,"words":1321},"git":{"createdTime":1759222669000,"updatedTime":1759222669000,"contributors":[{"name":"pylixm","username":"pylixm","email":"pyli.xm@gmail.com","commits":1,"avatar":"https://avatars.githubusercontent.com/pylixm?v=4","url":"https://github.com/pylixm"}]},"autoDesc":true,"filePathRelative":"01.开发语言/01.Python/01.语言特性/08.Python-basis-scope.md","headers":[],"categoryList":[{"id":"59843f","sort":1,"name":"开发语言"},{"id":"9d2a49","sort":1,"name":"Python"},{"id":"406962","sort":1,"name":"语言特性"}]}');export{e as comp,d as data};
